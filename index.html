<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶Æ‡¶ø‡¶â‡¶ú‡¶ø‡¶ï ‡¶Æ‡ßá‡¶≤‡¶æ-‡¶∏‡¶¨‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ö‡¶≤‡¶ü‡¶æ‡¶á‡¶Æ ‡¶ñ‡ßã‡¶≤‡¶æ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(124deg, #ff2400, #e81d1d, #e8b71d, #e3e81d, #1de840, #1ddde8, #2b1de8, #dd00f3, #dd00f3);
            background-size: 1800% 1800%;
            animation: rainbow 18s ease infinite;
            min-height: 100vh;
            color: #fff;
            user-select: none; -webkit-user-select: none;
        }
        @keyframes rainbow { 
            0%{background-position:0% 82%} 50%{background-position:100% 19%} 100%{background-position:0% 82%}
        }
        .glass { background: rgba(255, 255, 255, 0.95); color: #1e293b; border-radius: 20px; }
        .blink-card { border: 3px solid #ff0080; animation: blink 1.5s infinite; }
        @keyframes blink { 50% { border-color: #fff; box-shadow: 0 0 20px #ff0080; } }
        .zoom-box { overflow: hidden; border-radius: 15px; background: #fff; aspect-ratio: 1/1; }
        .zoom-box img { transition: 0.5s ease; width: 100%; height: 100%; object-fit: contain; }
        .zoom-box:hover img { transform: scale(1.3); }
    </style>
</head>
<body class="p-4 md:p-8">

    <header class="max-w-7xl mx-auto flex justify-between items-center mb-8">
        <div>
            <h1 class="text-4xl font-bold tracking-tighter">‡¶Æ‡¶ø‡¶â‡¶ú‡¶ø‡¶ï ‡¶Æ‡ßá‡¶≤‡¶æ üé∂</h1>
            <p id="status" class="text-yellow-300 text-xs font-bold uppercase">‡¶∏‡ßá‡¶∞‡¶æ ‡¶¨‡¶æ‡¶¶‡ßç‡¶Ø‡¶Ø‡¶®‡ßç‡¶§‡ßç‡¶∞‡ßá‡¶∞ ‡¶∂‡¶™</p>
            <p class="text-sm">MOBILE NO 6295419940 / 9932642750</p>
        </div>
        <div class="flex gap-3">
            <button onclick="adminLogin()" id="loginBtn" class="bg-black/20 p-3 rounded-full hover:bg-black/40">‚öôÔ∏è</button>
            <button onclick="location.reload()" id="logoutBtn" class="hidden bg-red-600 px-4 py-2 rounded-xl text-xs font-bold">‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</button>
        </div>
    </header>

    <div class="max-w-7xl mx-auto mb-10 text-center">
        <input type="text" id="searchInput" placeholder="‡¶¨‡¶æ‡¶¶‡ßç‡¶Ø‡¶Ø‡¶®‡ßç‡¶§‡ßç‡¶∞‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßá ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶ï‡¶∞‡ßÅ‡¶®..." 
        class="w-full md:w-1/2 p-4 rounded-2xl bg-white/20 border border-white/40 text-white placeholder-white/70 outline-none backdrop-blur-md">
    </div>

    <div id="adminPanel" class="hidden max-w-6xl mx-auto glass p-6 mb-12 border-4 border-white/50 shadow-2xl">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div class="space-y-3">
                <h3 class="font-bold text-blue-600 border-b pb-2 uppercase text-xs">üõí ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú</h3>
                <input type="hidden" id="pId">
                <input type="text" id="pName" placeholder="‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ" class="w-full p-2 border rounded-lg text-black">
                <div class="grid grid-cols-2 gap-2">
                    <input type="number" id="pOld" placeholder="‡¶™‡ßÅ‡¶∞‡¶æ‡¶®‡ßã ‡¶¶‡¶æ‡¶Æ" class="p-2 border rounded-lg text-black">
                    <input type="number" id="pNew" placeholder="‡¶®‡¶§‡ßÅ‡¶® ‡¶¶‡¶æ‡¶Æ" class="p-2 border rounded-lg text-black">
                </div>
                <textarea id="pDesc" placeholder="‡¶¨‡¶∞‡ßç‡¶£‡¶®‡¶æ..." class="w-full p-2 border rounded-lg h-16 text-black"></textarea>
                <div class="grid grid-cols-2 gap-2 text-[10px] text-black">
                    <input type="file" id="f1"><input type="file" id="f2">
                    <input type="file" id="f3"><input type="file" id="f4">
                </div>
                <button onclick="saveProduct()" id="pBtn" class="w-full bg-blue-600 text-white font-bold py-2 rounded-lg">‡¶∏‡ßá‡¶≠ ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü</button>
            </div>
            <div class="space-y-3">
                <h3 class="font-bold text-pink-600 border-b pb-2 uppercase text-xs">üìÖ ‡¶Ö‡¶®‡ßÅ‡¶∑‡ßç‡¶†‡¶æ‡¶® ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú</h3>
                <input type="hidden" id="eId">
                <input type="text" id="eT" placeholder="‡¶Ö‡¶®‡ßÅ‡¶∑‡ßç‡¶†‡¶æ‡¶®‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ" class="w-full p-2 border rounded-lg text-black">
                <input type="text" id="eTime" placeholder="‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ/‡¶∏‡¶Æ‡ßü" class="w-full p-2 border rounded-lg text-black">
                <input type="text" id="eAddr" placeholder="‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ" class="w-full p-2 border rounded-lg text-black">
                <input type="number" id="eWa" placeholder="WhatsApp" class="w-full p-2 border rounded-lg text-black">
                <input type="file" id="eF" class="text-black text-xs">
                <button onclick="saveEvent()" id="eBtn" class="w-full bg-pink-600 text-white font-bold py-2 rounded-lg">‡¶∏‡ßá‡¶≠ ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü</button>
            </div>
        </div>
    </div>

    <div class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-4 gap-8">
        <div class="lg:col-span-3">
            <h2 class="text-2xl font-bold mb-6">üé∏ ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶∂‡¶™</h2>
            <div id="p-list" class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-6"></div>
        </div>
        <div class="lg:col-span-1">
            <h2 class="text-2xl font-bold mb-6">üìÖ ‡¶¨‡ßÅ‡¶ï‡¶ø‡¶Ç ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶®</h2>
            <div id="e-list" class="space-y-6"></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, updateDoc, onSnapshot, doc, deleteDoc, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAcbHZOUIT_KubZKYzCfpXCdyzObPM8slM",
            authDomain: "musicmela-9564.firebaseapp.com",
            projectId: "musicmela-9564",
            storageBucket: "musicmela-9564.firebasestorage.app",
            messagingSenderId: "663574771422",
            appId: "1:663574771422:web:6a4827d65e1aab29b3b44f"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        let isAdmin = false, allP = [];

        // ‡¶ö‡¶ø‡¶§‡ßç‡¶∞ ‡¶õ‡ßã‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
        const compress = (file) => new Promise(res => {
            const r = new FileReader(); r.readAsDataURL(file);
            r.onload = e => {
                const img = new Image(); img.src = e.target.result;
                img.onload = () => {
                    const c = document.createElement('canvas');
                    c.width = 500; c.height = 500;
                    c.getContext('2d').drawImage(img, 0, 0, 500, 500);
                    res(c.toDataURL('image/jpeg', 0.7));
                }
            }
        });

        // Admin Login
        window.adminLogin = () => {
            if(prompt("‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°?") === "PALBABU") {
                isAdmin = true;
                document.getElementById('adminPanel').classList.remove('hidden');
                document.getElementById('logoutBtn').classList.remove('hidden');
                document.getElementById('loginBtn').classList.add('hidden');
                window.renderP(allP);
            }
        };

        // Product Save
        window.saveProduct = async () => {
            const id = document.getElementById('pId').value;
            const btn = document.getElementById('pBtn');
            btn.innerText = "‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®...";
            btn.disabled = true;

            const imgs = await Promise.all(['f1','f2','f3','f4'].map(async f => {
                const file = document.getElementById(f).files[0];
                return file ? await compress(file) : null;
            }));
            
            const data = {
                name: document.getElementById('pName').value,
                old: document.getElementById('pOld').value,
                new: document.getElementById('pNew').value,
                desc: document.getElementById('pDesc').value,
                date: Date.now()
            };
            const validImgs = imgs.filter(i => i !== null);
            if(validImgs.length > 0) data.images = validImgs;
            
            try {
                if(id) await updateDoc(doc(db, "products", id), data);
                else await addDoc(collection(db, "products"), data);
                alert("‡¶∏‡¶´‡¶≤ ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
                location.reload();
            } catch(e) { alert("‡¶≠‡ßÅ‡¶≤ ‡¶π‡ßü‡ßá‡¶õ‡ßá!"); }
        };

        // Event Save
        window.saveEvent = async () => {
            const id = document.getElementById('eId').value;
            const data = {
                t: document.getElementById('eT').value,
                time: document.getElementById('eTime').value,
                addr: document.getElementById('eAddr').value,
                wa: document.getElementById('eWa').value,
                date: Date.now()
            };
            const f = document.getElementById('eF').files[0];
            if(f) data.img = await compress(f);
            
            if(id) await updateDoc(doc(db, "events", id), data);
            else await addDoc(collection(db, "events"), data);
            alert("‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡ßá‡¶≠ ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
            location.reload();
        };

        window.renderP = (arr) => {
            document.getElementById('p-list').innerHTML = arr.map(p => `
                <div class="glass p-4 shadow-xl flex flex-col h-full text-slate-800">
                    <div class="zoom-box mb-3"><img id="m-${p.id}" src="${p.images ? p.images[0] : ''}"></div>
                    <div class="flex gap-1 mb-3 justify-center">
                        ${p.images ? p.images.map(i => `<img src="${i}" onclick="document.getElementById('m-${p.id}').src='${i}'" class="w-8 h-8 border rounded cursor-pointer">`).join('') : ''}
                    </div>
                    <h3 class="font-bold text-lg">${p.name}</h3>
                    <div class="flex items-center gap-2 mb-2 font-bold">
                        <span class="text-xs line-through text-gray-400">‡ß≥${p.old}</span>
                        <span class="text-xl text-red-600">‡ß≥${p.new}</span>
                    </div>
                    <p class="text-[11px] text-gray-500 mb-4">${p.desc}</p>
                    <div class="mt-auto">
                        <a href="https://wa.me/919932642750?text=I want to buy ${p.name}" class="block bg-green-500 text-white text-center py-2 rounded-xl font-bold">‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</a>
                        ${isAdmin ? `<div class="flex gap-2 mt-2">
                            <button onclick="editP('${p.id}','${p.name}','${p.old}','${p.new}','${p.desc}')" class="flex-1 bg-blue-100 text-blue-600 py-1 rounded text-xs font-bold">‡¶è‡¶°‡¶ø‡¶ü</button>
                            <button onclick="del('products','${p.id}')" class="flex-1 bg-red-100 text-red-600 py-1 rounded text-xs font-bold">‡¶°‡¶ø‡¶≤‡¶ø‡¶ü</button>
                        </div>` : ''}
                    </div>
                </div>
            `).join('');
        };

        window.editP = (id,n,o,nw,d) => {
            document.getElementById('pId').value = id; 
            document.getElementById('pName').value = n;
            document.getElementById('pOld').value = o; 
            document.getElementById('pNew').value = nw;
            document.getElementById('pDesc').value = d; 
            window.scrollTo(0,0);
        };

        window.del = async (c,i) => { 
            if(confirm("‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§?")) await deleteDoc(doc(db, c, i)); 
        };

        // Real-time Listeners
        onSnapshot(query(collection(db, "products"), orderBy("date", "desc")), s => {
            allP = s.docs.map(d => ({id: d.id, ...d.data()}));
            window.renderP(allP);
        });

        onSnapshot(query(collection(db, "events"), orderBy("date", "desc")), s => {
            document.getElementById('e-list').innerHTML = s.docs.map(d => {
                const e = d.data();
                return `
                    <div class="blink-card p-3 rounded-2xl bg-white/20 backdrop-blur-md">
                        <img src="${e.img || ''}" class="w-full h-40 object-cover rounded-xl mb-3">
                        <h4 class="font-bold text-white">${e.t}</h4>
                        <p class="text-[10px] text-yellow-200">‚è∞ ${e.time}</p>
                        <p class="text-[10px] text-white/80">üìç ${e.addr}</p>
                        <a href="https://wa.me/${e.wa}" class="block bg-green-500 text-center py-2 mt-2 rounded-lg text-xs font-bold text-white">‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó</a>
                        ${isAdmin ? `<button onclick="del('events','${d.id}')" class="text-red-300 text-[10px] font-bold mt-2">‡¶°‡¶ø‡¶≤‡¶ø‡¶ü</button>` : ''}
                    </div>
                `;
            }).join('');
        });

        document.getElementById('searchInput').addEventListener('input', e => {
            const term = e.target.value.toLowerCase();
            const filtered = allP.filter(p => p.name.toLowerCase().includes(term));
            window.renderP(filtered);
        });
    </script>

    <script>
        // Right click protection
        document.addEventListener('contextmenu', e => e.preventDefault());
    </script>
</body>
</html>
