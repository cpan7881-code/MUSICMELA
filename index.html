<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶Æ‡¶ø‡¶â‡¶ú‡¶ø‡¶ï ‡¶Æ‡ßá‡¶≤‡¶æ-‡¶∏‡¶¨‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ö‡¶≤‡¶ü‡¶æ‡¶á‡¶Æ ‡¶ñ‡ßã‡¶≤‡¶æ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(124deg, #ff2400, #e81d1d, #e8b71d, #e3e81d, #1de840, #1ddde8, #2b1de8, #dd00f3, #dd00f3);
            background-size: 1800% 1800%;
            animation: rainbow 18s ease infinite;
            min-height: 100vh;
            color: #fff;
            user-select: none; -webkit-user-select: none;
        }
        @keyframes rainbow { 
            0%{background-position:0% 82%} 50%{background-position:100% 19%} 100%{background-position:0% 82%}
        }
        .glass { background: rgba(255, 255, 255, 0.95); color: #1e293b; border-radius: 20px; }
        .blink-card { border: 3px solid #ff0080; animation: blink 1.5s infinite; }
        @keyframes blink { 50% { border-color: #fff; box-shadow: 0 0 20px #ff0080; } }
        .zoom-box { overflow: hidden; border-radius: 15px; background: #fff; aspect-ratio: 1/1; position: relative;}
        .zoom-box img { transition: 0.5s ease; width: 100%; height: 100%; object-fit: contain; }
        .zoom-box:hover img { transform: scale(1.3); }
    </style>
</head>
<body class="p-4 md:p-8">

    <header class="max-w-7xl mx-auto flex justify-between items-center mb-8">
        <div>
            <h1 class="text-4xl font-bold tracking-tighter">‡¶Æ‡¶ø‡¶â‡¶ú‡¶ø‡¶ï ‡¶Æ‡ßá‡¶≤‡¶æ üé∂</h1>
            <p id="status" class="text-yellow-300 text-xs font-bold uppercase">‡¶∏‡ßá‡¶∞‡¶æ ‡¶¨‡¶æ‡¶¶‡ßç‡¶Ø‡¶Ø‡¶®‡ßç‡¶§‡ßç‡¶∞‡ßá‡¶∞ ‡¶∂‡¶™</p>
            <p class="text-sm">‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤: 6295419940 / 9932642750</p>
        </div>
        <div class="flex gap-3">
            <button onclick="adminLogin()" id="loginBtn" class="bg-black/20 p-3 rounded-full hover:bg-black/40">‚öôÔ∏è</button>
            <button onclick="location.reload()" id="logoutBtn" class="hidden bg-red-600 px-4 py-2 rounded-xl text-xs font-bold">‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</button>
        </div>
    </header>

    <div class="max-w-7xl mx-auto mb-10">
        <input type="text" id="searchInput" placeholder="‡¶¨‡¶æ‡¶¶‡ßç‡¶Ø‡¶Ø‡¶®‡ßç‡¶§‡ßç‡¶∞‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßá ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶ï‡¶∞‡ßÅ‡¶®..." 
        class="w-full md:w-1/2 p-4 rounded-2xl bg-white/20 border border-white/40 text-white placeholder-white/70 outline-none backdrop-blur-md">
    </div>

    <div id="adminPanel" class="hidden max-w-6xl mx-auto glass p-6 mb-12 border-4 border-white/50 shadow-2xl">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div class="space-y-3">
                <h3 class="font-bold text-blue-600 border-b pb-2 uppercase text-xs">üõí ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                <input type="hidden" id="pId">
                <input type="text" id="pName" placeholder="‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ" class="w-full p-2 border rounded-lg text-black">
                <div class="grid grid-cols-2 gap-2">
                    <input type="number" id="pOld" placeholder="‡¶™‡ßÅ‡¶∞‡¶æ‡¶®‡ßã ‡¶¶‡¶æ‡¶Æ R.S-" class="p-2 border rounded-lg text-black">
                    <input type="number" id="pNew" placeholder="‡¶Ö‡¶´‡¶æ‡¶∞ ‡¶¶‡¶æ‡¶Æ R.S-" class="p-2 border rounded-lg text-black">
                </div>
                <textarea id="pDesc" placeholder="‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶¨‡¶∞‡ßç‡¶£‡¶®‡¶æ..." class="w-full p-2 border rounded-lg h-16 text-black"></textarea>
                <div class="grid grid-cols-2 gap-2 text-[10px] text-black">
                    <input type="file" id="f1"><input type="file" id="f2">
                    <input type="file" id="f3"><input type="file" id="f4">
                </div>
                <button onclick="saveProduct()" id="pBtn" class="w-full bg-blue-600 text-white font-bold py-2 rounded-lg">‡¶∏‡ßá‡¶≠ ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü</button>
            </div>
            
            <div class="space-y-3">
                <h3 class="font-bold text-pink-600 border-b pb-2 uppercase text-xs">üìÖ ‡¶Ö‡¶®‡ßÅ‡¶∑‡ßç‡¶†‡¶æ‡¶® ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                <input type="hidden" id="eId">
                <input type="text" id="eT" placeholder="‡¶Ö‡¶®‡ßÅ‡¶∑‡ßç‡¶†‡¶æ‡¶®‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ" class="w-full p-2 border rounded-lg text-black">
                <input type="text" id="eTime" placeholder="‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶ì ‡¶∏‡¶Æ‡¶Ø‡¶º" class="w-full p-2 border rounded-lg text-black">
                <input type="text" id="eAddr" placeholder="‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ" class="w-full p-2 border rounded-lg text-black">
                <input type="number" id="eWa" placeholder="‡¶π‡ßã‡¶Ø‡¶º‡¶æ‡¶ü‡¶∏‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ (‡¶Ø‡ßá‡¶Æ‡¶®: 9932642750)" class="w-full p-2 border rounded-lg text-black">
                <input type="file" id="eF" class="text-black text-xs">
                <button onclick="saveEvent()" id="eBtn" class="w-full bg-pink-600 text-white font-bold py-2 rounded-lg">‡¶∏‡ßá‡¶≠ ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶®</button>
            </div>
        </div>
    </div>

    <div class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-4 gap-8">
        <div class="lg:col-span-3">
            <h2 class="text-2xl font-bold mb-6">üé∏ ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶∂‡¶™</h2>
            <div id="p-list" class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-6"></div>
        </div>
        <div class="lg:col-span-1">
            <h2 class="text-2xl font-bold mb-6">üìÖ ‡¶∂‡¶ø‡¶≤‡ßç‡¶™‡ßÄ‡¶¶‡ßá‡¶∞ ‡¶¨‡ßÅ‡¶ï‡¶ø‡¶Ç ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶®</h2>
            <div id="e-list" class="space-y-6"></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, updateDoc, onSnapshot, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAcbHZOUIT_KubZKYzCfpXCdyzObPM8slM",
            authDomain: "musicmela-9564.firebaseapp.com",
            projectId: "musicmela-9564",
            storageBucket: "musicmela-9564.firebasestorage.app",
            messagingSenderId: "663574771422",
            appId: "1:663574771422:web:6a4827d65e1aab29b3b44f"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        let isAdmin = false, allP = [], allE = [];

        const compress = (file) => new Promise(res => {
            const r = new FileReader(); r.readAsDataURL(file);
            r.onload = e => {
                const img = new Image(); img.src = e.target.result;
                img.onload = () => {
                    const c = document.createElement('canvas');
                    c.width = 600; c.height = 600;
                    c.getContext('2d').drawImage(img, 0, 0, 600, 600);
                    res(c.toDataURL('image/jpeg', 0.6));
                }
            }
        });

        window.adminLogin = () => {
            if(prompt("‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°?") === "PALBABU") {
                isAdmin = true;
                document.getElementById('adminPanel').classList.remove('hidden');
                document.getElementById('logoutBtn').classList.remove('hidden');
                document.getElementById('loginBtn').classList.add('hidden');
                renderP(allP);
                renderE(allE);
            }
        };

        window.saveProduct = async () => {
            const id = document.getElementById('pId').value;
            const btn = document.getElementById('pBtn');
            btn.disabled = true; btn.innerText = "‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...";

            const imgs = await Promise.all(['f1','f2','f3','f4'].map(async f => {
                const file = document.getElementById(f).files[0];
                return file ? await compress(file) : null;
            }));
            
            const data = {
                name: document.getElementById('pName').value,
                old: document.getElementById('pOld').value || 0,
                new: document.getElementById('pNew').value,
                desc: document.getElementById('pDesc').value,
                date: Date.now()
            };
            const vImgs = imgs.filter(i => i !== null);
            if(vImgs.length > 0) data.images = vImgs;
            
            try {
                if(id) await updateDoc(doc(db, "products", id), data);
                else await addDoc(collection(db, "products"), data);
                alert("‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡ßá‡¶≠ ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
                location.reload();
            } catch (e) { alert("Error: " + e.message); btn.disabled = false; }
        };

        window.saveEvent = async () => {
            const id = document.getElementById('eId').value;
            const btn = document.getElementById('eBtn');
            btn.disabled = true; btn.innerText = "‡¶∏‡ßá‡¶≠ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...";

            const data = {
                t: document.getElementById('eT').value,
                time: document.getElementById('eTime').value,
                addr: document.getElementById('eAddr').value,
                wa: document.getElementById('eWa').value,
                date: Date.now()
            };
            const f = document.getElementById('eF').files[0];
            if(f) data.img = await compress(f);
            
            try {
                if(id) await updateDoc(doc(db, "events", id), data);
                else await addDoc(collection(db, "events"), data);
                alert("‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶∏‡ßá‡¶≠ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!");
                location.reload();
            } catch (e) { alert("Error: " + e.message); btn.disabled = false; }
        };

        const renderP = (arr) => {
            const sorted = [...arr].sort((a,b) => b.date - a.date);
            document.getElementById('p-list').innerHTML = sorted.map(p => `
                <div class="glass p-4 shadow-xl flex flex-col h-full text-slate-800">
                    <div class="zoom-box mb-3"><img id="m-${p.id}" src="${(p.images && p.images[0]) ? p.images[0] : 'https://via.placeholder.com/300?text=No+Image'}"></div>
                    <div class="flex gap-1 mb-3 justify-center overflow-x-auto">
                        ${p.images ? p.images.map(i => `<img src="${i}" onclick="document.getElementById('m-${p.id}').src='${i}'" class="w-10 h-10 border rounded cursor-pointer object-cover">`).join('') : ''}
                    </div>
                    <h3 class="font-bold text-lg">${p.name}</h3>
                    <div class="flex items-center gap-2 mb-2 font-bold">
                        <span class="text-xs line-through text-gray-400">R.S-{p.old}</span>
                        <span class="text-xl text-red-600">R.S-{p.new}</span>
                    </div>
                    <p class="text-[11px] text-gray-500 mb-4">${p.desc}</p>
                    <div class="mt-auto">
                        <a href="https://wa.me/919932642750?text=I want to buy ${p.name}" target="_blank" class="block bg-green-500 text-white text-center py-2 rounded-xl font-bold">‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</a>
                        ${isAdmin ? `<div class="flex gap-2 mt-2">
                            <button onclick="editP('${p.id}','${p.name.replace(/'/g, "\\'")}','${p.old}','${p.new}','${p.desc.replace(/'/g, "\\'")}')" class="flex-1 bg-blue-100 text-blue-600 py-1 rounded text-xs font-bold">‡¶è‡¶°‡¶ø‡¶ü</button>
                            <button onclick="del('products','${p.id}')" class="flex-1 bg-red-100 text-red-600 py-1 rounded text-xs font-bold">‡¶°‡¶ø‡¶≤‡¶ø‡¶ü</button>
                        </div>` : ''}
                    </div>
                </div>
            `).join('');
        };

        const renderE = (arr) => {
            const sorted = [...arr].sort((a,b) => b.date - a.date);
            document.getElementById('e-list').innerHTML = sorted.map(e => `
                <div class="blink-card p-3 rounded-2xl bg-white/20 backdrop-blur-md">
                    <img src="${e.img || 'https://via.placeholder.com/300?text=Event'}" class="w-full h-40 object-cover rounded-xl mb-3">
                    <h4 class="font-bold text-white text-lg">${e.t}</h4>
                    <p class="text-xs text-yellow-200 mt-1">‚è∞ ${e.time}</p>
                    <p class="text-xs text-white/80">üìç ${e.addr}</p>
                    <a href="https://wa.me/91${e.wa}?text=Hello, I am interested in ${e.t}" target="_blank" 
                       class="block bg-green-500 text-center py-2 mt-3 rounded-lg text-sm font-bold text-white shadow-lg">‡¶¨‡ßÅ‡¶ï‡¶ø‡¶Ç ‡¶ï‡¶∞‡¶§‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®</a>
                    ${isAdmin ? `
                    <div class="flex gap-2 mt-3">
                        <button onclick="editE('${e.id}','${e.t.replace(/'/g, "\\'")}','${e.time}','${e.addr.replace(/'/g, "\\'")}','${e.wa}')" class="flex-1 bg-blue-500 text-white text-[10px] py-1 rounded">‡¶è‡¶°‡¶ø‡¶ü</button>
                        <button onclick="del('events','${e.id}')" class="flex-1 bg-red-500 text-white text-[10px] py-1 rounded">‡¶°‡¶ø‡¶≤‡¶ø‡¶ü</button>
                    </div>` : ''}
                </div>
            `).join('');
        };

        window.editP = (id,n,o,nw,d) => {
            document.getElementById('pId').value = id; 
            document.getElementById('pName').value = n;
            document.getElementById('pOld').value = o; 
            document.getElementById('pNew').value = nw;
            document.getElementById('pDesc').value = d; 
            window.scrollTo({top: 0, behavior: 'smooth'});
        };

        window.editE = (id,t,time,addr,wa) => {
            document.getElementById('eId').value = id;
            document.getElementById('eT').value = t;
            document.getElementById('eTime').value = time;
            document.getElementById('eAddr').value = addr;
            document.getElementById('eWa').value = wa;
            window.scrollTo({top: 0, behavior: 'smooth'});
        };

        window.del = async (c,i) => { 
            if(confirm("‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶è‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡¶§‡ßá ‡¶ö‡¶æ‡¶®?")) {
                try {
                    await deleteDoc(doc(db, c, i));
                    alert("‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
                } catch(e) { alert("Error: " + e.message); }
            }
        };

        onSnapshot(collection(db, "products"), s => {
            allP = s.docs.map(d => ({id: d.id, ...d.data()}));
            renderP(allP);
        });

        onSnapshot(collection(db, "events"), s => {
            allE = s.docs.map(d => ({id: d.id, ...d.data()}));
            renderE(allE);
        });

        document.getElementById('searchInput').addEventListener('input', e => {
            const term = e.target.value.toLowerCase();
            const filtered = allP.filter(p => p.name.toLowerCase().includes(term));
            renderP(filtered);
        });
    </script>

    <script>
        document.addEventListener('contextmenu', e => e.preventDefault());
        document.onkeydown = e => {
            if (e.keyCode == 123 || (e.ctrlKey && e.shiftKey && (e.keyCode == 73 || e.keyCode == 74)) || (e.ctrlKey && e.keyCode == 85)) return false;
        };
    </script>
    <script>
    /* ‡ßß. ‡¶∞‡¶æ‡¶á‡¶ü ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶°‡¶ø‡¶ú‡ßá‡¶¨‡¶≤ ‡¶ï‡¶∞‡¶æ */
    document.addEventListener('contextmenu', event => event.preventDefault());

    /* ‡ß®. ‡¶ï‡¶ø‡¶¨‡ßã‡¶∞‡ßç‡¶° ‡¶∂‡¶∞‡ßç‡¶ü‡¶ï‡¶æ‡¶ü (F12, Ctrl+U, Ctrl+Shift+I) ‡¶¨‡ßç‡¶≤‡¶ï ‡¶ï‡¶∞‡¶æ */
    document.onkeydown = function(e) {
        if (e.keyCode == 123 || // F12
            (e.ctrlKey && e.shiftKey && (e.keyCode == 'I'.charCodeAt(0) || e.keyCode == 'J'.charCodeAt(0) || e.keyCode == 'C'.charCodeAt(0))) || 
            (e.ctrlKey && e.keyCode == 'U'.charCodeAt(0))) { // Ctrl+U (View Source)
            return false;
        }
    };

    /* ‡ß©. ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶´‡¶ø‡¶≤‡ßç‡¶° ‡¶•‡ßá‡¶ï‡ßá ‡¶ï‡¶™‡¶ø-‡¶™‡ßá‡¶∏‡ßç‡¶ü ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡¶æ */
    const passField = document.getElementById('loginPass');
    if(passField) {
        passField.oncopy = e => e.preventDefault();
        passField.onpaste = e => e.preventDefault();
        passField.oncut = e => e.preventDefault();
    }

    /* ‡ß™. ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡¶∂‡¶® ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡¶æ (‡¶™‡ßÅ‡¶∞‡ßã ‡¶∏‡¶æ‡¶á‡¶ü‡ßá) */
    document.onselectstart = () => false; 
</script>
</body>
</html>


